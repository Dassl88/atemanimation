<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Rauchfrei Tracker Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      padding: 20px;
      background-color: #111;
      font-family: Arial, sans-serif;
      color: white;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .button-primary {
      background-color: #10b981;
      color: white;
    }
    .button-reset {
      background-color: #ef4444;
      color: white;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    .reel {
      background: #222;
      border-radius: 16px;
      padding: 20px;
      width: 250px;
      text-align: center;
    }
    .progress-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(#10b981 0%, #333 0%);
      margin: 10px auto;
      position: relative;
    }
    .progress-circle span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      color: white;
    }
    .info-box {
      background: #111;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .milestone-status {
      margin-top: 5px;
      color: #10b981;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <h1>üö≠ Rauchfrei Tracker Pro</h1>

  <div style="text-align: center;">
    <button class="button button-primary" onclick="showProgress()">Fortschritt anzeigen</button>
    <button class="button button-reset" onclick="resetData()">Daten zur√ºcksetzen</button>
    <button class="button" onclick="toggleSettings()">‚öôÔ∏è Einstellungen</button>
  </div>

  <div id="settings" class="info-box hidden">
    <h2>Einstellungen</h2>
    <label>Aufh√∂rdatum & Uhrzeit:</label><br />
    <input type="datetime-local" id="quitDate" /><br />

    <label>Zigaretten pro Tag:</label><br />
    <input type="number" id="cigsPerDay" value="20" /><br />

    <label>Preis pro Schachtel (‚Ç¨):</label><br />
    <input type="number" id="packPrice" value="8" step="0.01" /><br />

    <label>Zigaretten pro Schachtel:</label><br />
    <input type="number" id="cigsPerPack" value="20" /><br />

    <label>Alter:</label><br />
    <input type="number" id="age" value="30" /><br />

    <label>Gerauchte Jahre:</label><br />
    <input type="number" id="yearsSmoked" value="10" /><br />

    <hr />
    <h3>Benutzerdefinierten Meilenstein hinzuf√ºgen</h3>
    <input type="text" id="customTitle" placeholder="Titel"><br />
    <input type="number" id="customMinutes" placeholder="Minuten seit Rauchstopp"><br />
    <input type="text" id="customDescription" placeholder="Beschreibung (optional)"><br />
    <button class="button button-primary" onclick="addCustomMilestone(
      document.getElementById('customTitle').value,
      document.getElementById('customMinutes').value,
      document.getElementById('customDescription').value
    )">‚ûï Meilenstein hinzuf√ºgen</button>
  </div>

  <div id="info" class="info-box"></div>
  <div id="reels" class="grid"></div>

  <script>
    const milestones = [
      { title: "Blutdruck normalisiert sich", minutes: 20, description: "Schon nach 20 Minuten beginnt dein K√∂rper sich zu erholen." },
      { title: "Puls wird ruhiger", minutes: 30, description: "Der Puls sinkt auf ein gesundes Niveau." },
      { title: "Mehr Sauerstoff", hours: 8, description: "Dein Blut enth√§lt weniger Kohlenmonoxid." },
      { title: "Geruchssinn verbessert sich", days: 2, description: "Dein Geschmack und Geruch kehren zur√ºck." },
      { title: "Nikotin abgebaut", days: 3, description: "Kein Nikotin mehr im K√∂rper." },
      { title: "Energie kehrt zur√ºck", days: 5, description: "Du f√ºhlst dich vitaler." },
      { title: "Kreislauf verbessert", weeks: 2, description: "Durchblutung und Ausdauer steigen." },
      { title: "Lungenfunktion steigt", months: 1, description: "Bessere Lungenkapazit√§t." },
      { title: "R√ºckfallrisiko sinkt", months: 6, description: "Weniger Verlangen." },
      { title: "Ein Jahr rauchfrei!", years: 1, description: "Herzinfarktrisiko stark reduziert." },
      { title: "Krebsrisiko sinkt", years: 5, description: "Lungenkrebsrisiko halbiert." },
      { title: "K√∂rper fast regeneriert", years: 15, description: "Herz-Kreislauf-System wie bei Nichtrauchern." }
    ];

    let customMilestones = JSON.parse(localStorage.getItem("customMilestones") || "[]");

    function toggleSettings() {
      document.getElementById("settings").classList.toggle("hidden");
    }

    function saveInputs() {
      const fields = ["quitDate", "cigsPerDay", "packPrice", "cigsPerPack", "age", "yearsSmoked"];
      fields.forEach(id => {
        const el = document.getElementById(id);
        if (el) localStorage.setItem(id, el.value);
      });
    }

    function loadInputs() {
      const fields = ["quitDate", "cigsPerDay", "packPrice", "cigsPerPack", "age", "yearsSmoked"];
      fields.forEach(id => {
        const el = document.getElementById(id);
        if (el && localStorage.getItem(id)) el.value = localStorage.getItem(id);
      });
    }

    function addCustomMilestone(title, minutesSinceQuit, description) {
      if (!title || isNaN(minutesSinceQuit)) {
        alert("Bitte g√ºltige Werte f√ºr Titel und Minuten eingeben.");
        return;
      }

      customMilestones.push({
        title: title,
        custom: true,
        minutes: parseFloat(minutesSinceQuit),
        description: description || ""
      });

      localStorage.setItem("customMilestones", JSON.stringify(customMilestones));
      showProgress();
    }

    function showProgress() {
      saveInputs();

      const quitInput = document.getElementById("quitDate").value;
      const cigsPerDay = parseInt(document.getElementById("cigsPerDay").value);
      const packPrice = parseFloat(document.getElementById("packPrice").value);
      const cigsPerPack = parseInt(document.getElementById("cigsPerPack").value);

      if (!quitInput || isNaN(cigsPerDay) || isNaN(packPrice) || isNaN(cigsPerPack)) {
        alert("Bitte alle Einstellungen korrekt ausf√ºllen.");
        return;
      }

      const quitTime = new Date(quitInput);
      const now = new Date();
      const diffMin = (now - quitTime) / 1000 / 60;

      const diffDays = diffMin / 1440;
      const totalCigsAvoided = Math.floor(cigsPerDay * diffDays);
      const totalMoneySaved = ((totalCigsAvoided / cigsPerPack) * packPrice).toFixed(2);
      const lifeRegainedMin = totalCigsAvoided * 11;
      const lifeRegainedHr = Math.floor(lifeRegainedMin / 60);
      const lifeRegainedMinRest = lifeRegainedMin % 60;

      const infoBox = document.getElementById("info");
      infoBox.innerHTML = `
        <h2>Dein Fortschritt</h2>
        <p><strong>Zigaretten vermieden:</strong> ${totalCigsAvoided}</p>
        <p><strong>Geld gespart:</strong> ‚Ç¨ ${totalMoneySaved}</p>
        <p><strong>Zur√ºckgewonnene Lebenszeit:</strong> ${lifeRegainedHr} Std ${lifeRegainedMinRest} Min</p>
      `;

      const reelsContainer = document.getElementById("reels");
      reelsContainer.innerHTML = "";

      [...milestones, ...customMilestones]
        .sort((a, b) => getMinutes(a) - getMinutes(b))
        .forEach(m => {
          const min = getMinutes(m);
          const percent = Math.min((diffMin / min) * 100, 100);
          const reel = document.createElement("div");
          reel.className = "reel";
          reel.innerHTML = `
            <h3>${m.title}</h3>
            <div class="progress-circle" style="background: conic-gradient(#10b981 ${percent}%, #333 ${percent}%);">
              <span>${Math.floor(percent)}%</span>
            </div>
            <p>${m.description}</p>
            ${percent === 100 ? '<p class="milestone-status">‚úÖ Erreicht!</p>' : ''}
          `;
          reelsContainer.appendChild(reel);
        });
    }

    function getMinutes(m) {
      if (m.minutes) return m.minutes;
      if (m.hours) return m.hours * 60;
      if (m.days) return m.days * 1440;
      if (m.weeks) return m.weeks * 10080;
      if (m.months) return m.months * 43200;
      if (m.years) return m.years * 525600;
      return 0;
    }

    function resetData() {
      if (confirm("Willst du wirklich alle Daten l√∂schen?")) {
        localStorage.clear();
        location.reload();
      }
    }

    window.onload = loadInputs;
  </script>
</body>
</html>
